.. -*- mode: rst -*-

Testing
=======

This folder contains the testsuite for ``svglib``. In order to run it
open a terminal, change into this folder and execute the following 
command (assuming you have ``pytest`` installed which is a simple
``pip install pytest``)::
 
    $ py.test -v

If for any reason you don't want to install ``pytest`` you can also
run the following (which installs ``pytest-runner`` during testing)::

    $ python setup.py test

If you have ``tox`` installed (``pip install tox``) you can simply
run the testsuite on Python 2.7 and Python 3.5 (assuming you have
them installed) or on a single version (this will not run with
``conda``, yet, though)::

    $ tox
    $ tox -e py27
    $ tox -e py35

All will run the entire testsuite and produce result files in PDF
format in the subdirectories ``tests/samples`` (here also in PNG),
``tests/wikipedia/flags`` and ``tests/wikipedia/symbols``, if the
corresponding SVG input files could be downloaded from the internet
at the start of the test or if they are still available from previous
runs.

To clean-up all files generated by ``svglib`` run this::

    $ py.test -v -s --override-ini=python_functions=cleanup

If you have a ``pytet`` plugin named ``pytest-coverage`` installed
(``pip install pytest-coverage``) you can run this to get a simple
coverage report (with some additional upfront cleaning)::

    rm tests/samples/W3C_SVG_12_TinyTestSuite.tar.gz
    rm -rf tests/samples/W3C_SVG_12_TinyTestSuite
    rm -rf tests/samples/wikipedia/flags
    rm -rf tests/samples/wikipedia/symbols
    PYTHONPATH=. py.test --cov=./svglib --cov=tests tests

As an experimental feature some of the tests try using a vector 
conversion tool named `UniConvertor 
<http://sourceforge.net/projects/uniconvertor>`_ 
(if installed) for producing PDFs for comparison with `svglib`.
(This was not used for years, though, during development/testing.)

Calling ``renderPM.drawToFile()`` in ``TestW3CSVG.test_convert_pdf_png()``
is known to raise a ``TypeError`` sometimes in reportlab which was
fixed in ``reportlab`` 3.3.26. See
https://github.com/deeplook/svglib/issues/47.
